function e(e,t,o){let r=[effector.step.run({fn:e=>t(e)})];if(o){let t=effector.createNode({node:r}),n=e.graphite.id,a=o.additionalLinks,l=a[n]||[];return a[n]=l,l.push(t),()=>{let e=l.indexOf(t);-1!==e&&l.splice(e,1),effector.clearNode(t)}}{let t=effector.createNode({node:r,parent:[e],family:{owners:e}});return()=>{effector.clearNode(t)}}}function t(e,t){return t?t.getState(e):e.getState()}function o(){let e,t=i.getCurrentInstance(),o=null==t?void 0:t.appContext.config.globalProperties.scopeName;return o&&(e=i.inject(o)),{scopeName:o,scope:e}}function r(e){let t=i.unref(e);return i.isReactive(t)?i.toRaw(t):t}function n(e,t=[]){if(null===e||'object'!=typeof e)return e;let o=t.filter((t=>t.original===e))[0];if(o)return o.copy;let r=Array.isArray(e)?[]:{};return t.push({original:e,copy:r}),Object.keys(e).forEach((o=>{r[o]=n(e[o],t)})),r}function a(a,l,s){if(!effector.is.store(a))throw Error("expect useVModel argument to be a store");let{scope:u}=o(),c=i.ref(n(t(a,u))),d=0,f=0,p=e(a,(e=>{d||(f=1,c.value=i.ref(n(e)).value)}),u);return i.onUnmounted((()=>{p()})),i.watch((()=>l&&s?s[l]:c.value),(e=>{if(d=1,!f){let t=i.ref(r(e)).value;a.setState(n(t))}f=0,d=0}),{deep:1,immediate:0}),c}function l(e,t){let o=t?e:e[0];var r;(e=>{if(!e)throw Error('expect first argument be an object')})(d(r=o)||(e=>'function'==typeof e)(r));let n=o.or,a=o.and;if(a){let o=t?a:a[0];if(d(o)&&'and'in o){let o=l(a,t);e=o[0],n={...n,...o[1]}}else e=a}return[e,n]}function s(e,t){let o,a;t&&(a=i.computed(t),o=i.watch(a,(t=>{let o=r(t);e.set(n(o))}),{deep:1,immediate:1})),i.onMounted((()=>{if(void 0!==a){let t=r(a.value);e.open(n(t))}else e.open()})),i.onUnmounted((()=>{if(void 0!==a){let t=r(a.value);e.close(n(t))}else e.close();o&&o()}))}Object.defineProperty(exports,'__esModule',{value:1});var effector=require('effector'),i=require('vue');let u=e=>{throw Error(e)};const c=(e,t)=>e!==t;let d=e=>'object'==typeof e&&null!==e,f=(e,t={})=>(d(e)&&(f(e.or,t),(e=>{for(let n in e)r=n,(e=>void 0===e)(o=e[n])||'or'===r||'and'===r||(t[r]=o);var o,r})(e),f(e.and,t)),t);exports.createGate=(...e)=>{function t(e){s(t,(()=>e))}var o;let r=e&&(e=>d(e)&&(e.and||e.or))(e[0])?e:[{and:e}],[[n],a]=l(r),i=f({or:a,and:n}),u=null==n?void 0:n.domain,c=`${u?`${u.compositeName.fullName}/`:''}${(null==i?void 0:i.name)||'gate'}`,p=effector.createEvent({name:`${c}.set`,sid:i.sid?`${i.sid}|set`:void 0}),v=effector.createEvent({name:`${c}.open`,sid:i.sid?`${i.sid}|open`:void 0}),m=effector.createEvent({name:`${c}.close`,sid:i.sid?`${i.sid}|close`:void 0}),y=effector.createStore(Boolean(0),{name:`${c}.status`,serialize:'ignore'}),h=effector.createStore(null!==(o=null==n?void 0:n.defaultState)&&void 0!==o?o:null,{name:`${c}.state`,sid:null==i?void 0:i.sid});if(h.on(p,((e,t)=>t)),y.on(v,(()=>Boolean(1))).on(m,(()=>Boolean(0))),t.open=v,t.close=m,t.status=y,t.state=h,t.set=p,effector.sample({clock:v,target:p}),h.reset(m),null!=n&&n.domain){let{hooks:e}=n.domain;effector.launch({target:[e.store,e.store,e.event,e.event,e.event],params:[y,h,v,m,p]})}return t},exports.useGate=s,exports.useStore=r=>{effector.is.store(r)||u("expect useStore argument to be a store");let{scope:n}=o(),a=t(r,n),l=i.shallowRef(a),s=e(r,(e=>{l.value=i.shallowRef(e).value}),n);return i.onUnmounted((()=>{s()})),i.readonly(l)},exports.useStoreMap=(e,r)=>{effector.is.store(e.store)||u('useStoreMap expects a store'),void 0!==e.keys&&'function'!=typeof e.keys&&u('useStoreMap expects keys as a function'),'function'!=typeof e.fn&&u('useStoreMap expects fn as a function');let n=r||o().scope,a=i.computed(e.keys?e.keys:()=>{}),l=e.updateFilter||c,s=t(e.store,n),d="object"==typeof s&&0==Array.isArray(s),f=d?i.shallowReactive(s):i.shallowRef(s),p=effector.createWatch({unit:e.store,fn:e=>{if(d)for(let t in e)l(e[t],f[t])&&(f[t]=e[t]);else void 0!==e&&l(e,f.value)&&(f.value=e)},scope:n});return i.onUnmounted((()=>{p()})),i.computed((()=>{let t=e.fn(d?f:f.value,a.value);return void 0!==t?t:e.defaultValue}))},exports.useVModel=e=>{if(effector.is.store(e))return a(e);let t=i.reactive({}),o=Object.fromEntries(Object.entries(e).map((([e,o])=>[e,a(o,e,t)])));for(let e in o)t[e]=o[e];return t};
//# sourceMappingURL=composition.cjs.js.map
