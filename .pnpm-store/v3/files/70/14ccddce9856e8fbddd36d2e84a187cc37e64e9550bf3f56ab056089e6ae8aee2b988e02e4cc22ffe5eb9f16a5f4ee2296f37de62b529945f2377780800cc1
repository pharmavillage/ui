function e(e,t,o){let n=[c.run({fn:e=>t(e)})];if(o){let t=d({node:n}),r=e.graphite.id,i=o.additionalLinks,a=i[r]||[];return i[r]=a,a.push(t),()=>{let e=a.indexOf(t);-1!==e&&a.splice(e,1),p(t)}}{let t=d({node:n,parent:[e],family:{owners:e}});return()=>{p(t)}}}function t(e,t){return t?t.getState(e):e.getState()}function o(){let e,t=h(),o=null==t?void 0:t.appContext.config.globalProperties.scopeName;return o&&(e=k(o)),{scopeName:o,scope:e}}function n(n){v.store(n)||C("expect useStore argument to be a store");let{scope:r}=o(),i=t(n,r),a=x(i),l=e(n,(e=>{a.value=x(e).value}),r);return j((()=>{l()})),S(a)}function r(e){let t=E(e);return w(t)?A(t):t}function i(e,t=[]){if(null===e||'object'!=typeof e)return e;let o=t.filter((t=>t.original===e))[0];if(o)return o.copy;let n=Array.isArray(e)?[]:{};return t.push({original:e,copy:n}),Object.keys(e).forEach((o=>{n[o]=i(e[o],t)})),n}function a(n,a,l){if(!v.store(n))throw Error("expect useVModel argument to be a store");let{scope:s}=o(),u=N(i(t(n,s))),f=0,c=0,d=e(n,(e=>{f||(c=1,u.value=N(i(e)).value)}),s);return j((()=>{d()})),O((()=>a&&l?l[a]:u.value),(e=>{if(f=1,!c){let t=N(r(e)).value;n.setState(i(t))}c=0,f=0}),{deep:1,immediate:0}),u}function l(e,n){v.store(e.store)||C('useStoreMap expects a store'),void 0!==e.keys&&'function'!=typeof e.keys&&C('useStoreMap expects keys as a function'),'function'!=typeof e.fn&&C('useStoreMap expects fn as a function');let r=n||o().scope,i=B(e.keys?e.keys:()=>{}),a=e.updateFilter||L,l=t(e.store,r),s="object"==typeof l&&0==Array.isArray(l),u=s?V(l):x(l),f=m({unit:e.store,fn:e=>{if(s)for(let t in e)a(e[t],u[t])&&(u[t]=e[t]);else void 0!==e&&a(e,u.value)&&(u.value=e)},scope:r});return j((()=>{f()})),B((()=>{let t=e.fn(s?u:u.value,i.value);return void 0!==t?t:e.defaultValue}))}function s(e,t){let o=t?e:e[0];var n;(e=>{if(!e)throw Error('expect first argument be an object')})(P(n=o)||(e=>'function'==typeof e)(n));let r=o.or,i=o.and;if(i){let o=t?i:i[0];if(P(o)&&'and'in o){let o=s(i,t);e=o[0],r={...r,...o[1]}}else e=i}return[e,r]}function u(e,t){let o,n;t&&(n=B(t),o=O(n,(t=>{let o=r(t);e.set(i(o))}),{deep:1,immediate:1})),z((()=>{if(void 0!==n){let t=r(n.value);e.open(i(t))}else e.open()})),j((()=>{if(void 0!==n){let t=r(n.value);e.close(i(t))}else e.close();o&&o()}))}function f(...e){function t(e){u(t,(()=>e))}var o;let n=e&&(e=>P(e)&&(e.and||e.or))(e[0])?e:[{and:e}],[[r],i]=s(n),a=W({or:i,and:r}),l=null==r?void 0:r.domain,f=`${l?`${l.compositeName.fullName}/`:''}${(null==a?void 0:a.name)||'gate'}`,c=y({name:`${f}.set`,sid:a.sid?`${a.sid}|set`:void 0}),d=y({name:`${f}.open`,sid:a.sid?`${a.sid}|open`:void 0}),p=y({name:`${f}.close`,sid:a.sid?`${a.sid}|close`:void 0}),v=g(Boolean(0),{name:`${f}.status`,serialize:'ignore'}),m=g(null!==(o=null==r?void 0:r.defaultState)&&void 0!==o?o:null,{name:`${f}.state`,sid:null==a?void 0:a.sid});if(m.on(c,((e,t)=>t)),v.on(d,(()=>Boolean(1))).on(p,(()=>Boolean(0))),t.open=d,t.close=p,t.status=v,t.state=m,t.set=c,b({clock:d,target:c}),m.reset(p),null!=r&&r.domain){let{hooks:e}=r.domain;$({target:[e.store,e.store,e.event,e.event,e.event],params:[v,m,d,p,c]})}return t}import{step as c,createNode as d,clearNode as p,is as v,createWatch as m,createEvent as y,createStore as g,sample as b,launch as $}from'effector/effector.mjs';import{getCurrentInstance as h,inject as k,shallowRef as x,onUnmounted as j,readonly as S,unref as E,isReactive as w,toRaw as A,reactive as M,ref as N,watch as O,computed as B,shallowReactive as V,onMounted as z}from'vue';let C=e=>{throw Error(e)},F=e=>{if(v.store(e))return a(e);let t=M({}),o=Object.fromEntries(Object.entries(e).map((([e,o])=>[e,a(o,e,t)])));for(let e in o)t[e]=o[e];return t};const L=(e,t)=>e!==t;let P=e=>'object'==typeof e&&null!==e,W=(e,t={})=>(P(e)&&(W(e.or,t),(e=>{for(let r in e)n=r,(e=>void 0===e)(o=e[r])||'or'===n||'and'===n||(t[n]=o);var o,n})(e),W(e.and,t)),t);export{f as createGate,u as useGate,n as useStore,l as useStoreMap,F as useVModel};
//# sourceMappingURL=composition.mjs.map
