"use strict";(self.webpackChunkshared_store=self.webpackChunkshared_store||[]).push([[810],{810:(e,t,r)=>{function a(e,t){for(let r in e)t(e[r],r)}function n(e,t){e.forEach(t)}function i(e,t){if(!e)throw Error(t)}function o(e,t){let r=W(e).meta||{};ve={id:W(e).id,parent:ve,value:e,template:r.template||we(),sidRoot:r.sidRoot||ve&&ve.sidRoot,meta:r};try{return t()}finally{ke("region"),ve=K(ve)}}function s({node:e=[],from:t,source:r,parent:a=t||r,to:i,target:o,child:s=i||o,scope:l={},meta:f={},family:d={type:"regular"},regional:u}={}){let c=$e(a),p=$e(d.links),m=$e(d.owners),h=[];n(e,(e=>e&&de(h,e)));let g={id:ge(),seq:h,next:$e(s),meta:f,scope:l,family:{type:d.type||"crosslink",links:p,owners:m}};return n(p,(e=>de(G(e),g))),n(m,(e=>de(H(e),g))),n(c,(e=>de(e.next,g))),u&&ve&&xe(V(ve),[g]),g}function l(e,t,r){let a,i=st,o=null,s=at;if(e.target&&(t=e.params,r=e.defer,a=e.meta,i="page"in e?e.page:i,e.stack&&(o=e.stack),s=Q(e)||s,e=e.target),s&&at&&s!==at&&(at=null),Array.isArray(e))for(let r=0;r<e.length;r++)Ze("pure",i,W(e[r]),o,t[r],s,a);else Ze("pure",i,W(e),o,t,s,a);if(r&&!nt)return;let l,f,d,u,c,p,m={isRoot:nt,currentPage:st,scope:at,isWatch:it,isPure:ot};nt=0;e:for(;u=Ye();){let{idx:e,stack:t,type:r}=u;d=t.node,st=c=t.page,at=Q(t),c?p=c.reg:at&&(p=at.reg);let a=!!c,i=!!at,o={fail:0,scope:d.scope};l=f=0;for(let n=e;n<d.seq.length&&!l;n++){let s=d.seq[n];if(s.order){let{priority:a,barrierID:i}=s.order,o=i?c?`${c.fullID}_${i}`:i:0;if(n!==e||r!==a){i?rt.has(o)||(rt.add(o),et(n,t,a,i)):et(n,t,a);continue e}i&&rt.delete(o)}switch(s.type){case"mov":{let e,r=s.data;switch(r.from){case T:e=V(t);break;case"a":case"b":e=t[r.from];break;case"value":e=r.store;break;case"store":if(p&&!p[r.store.id])if(a){let e=dt(c,r.store.id);t.page=c=e,e?p=e.reg:i?(ht(at,r.store,0,1,r.softRead),p=at.reg):p=void 0}else i&&ht(at,r.store,0,1,r.softRead);e=Ue(p&&p[r.store.id]||r.store)}switch(r.to){case T:t.value=e;break;case"a":case"b":t[r.to]=e;break;case"store":ct(c,at,d,r.target).current=e}break}case"compute":let e=s.data;if(e.fn){it="watch"===X(d,"op"),ot=e.pure;let r=e.safe?(0,e.fn)(V(t),o.scope,t):gt(o,e.fn,t);e.filter?f=!r:t.value=r,it=m.isWatch,ot=m.isPure}}l=o.fail||f}if(ut&&ut(t,o),!l){let e=V(t),r=Q(t);if(n(d.next,(a=>{Ze("child",c,a,t,e,r)})),r){X(d,"needFxCounter")&&Ze("child",c,r.fxCount,t,e,r),X(d,"storeChange")&&Ze("child",c,r.storeChange,t,e,r),X(d,"warnSerialize")&&Ze("child",c,r.warnSerializeNode,t,e,r);let a=r.additionalLinks[d.id];a&&n(a,(a=>{Ze("child",c,a,t,e,r)}))}}}nt=m.isRoot,st=m.currentPage,at=Q(m)}function f(e,t="combine"){let r=t+"(",n="",i=0;return a(e,(e=>{i<25&&(null!=e&&(r+=n,r+=ee(e)?Z(e).fullName:e.toString()),i+=1,n=", ")})),r+")"}function d(e,t){e.shortName=t,Object.assign(Z(e),u(t,K(e)))}function u(e,t){let r,a,n=e;if(t){let n=Z(t);0===e.length?(r=n.path,a=n.fullName):(r=n.path.concat([e]),a=0===n.fullName.length?e:n.fullName+"/"+e)}else r=0===e.length?[]:[e],a=e;return{shortName:n,fullName:a,path:r}}function c(e,t){let r=t?e:e[0];Ae(r);let a=r.or,n=r.and;if(n){let r=t?n:n[0];if(ze(r)&&"and"in r){let r=c(n,t);e=r[0],a={...a,...r[1]}}else e=n}return[e,a]}function p(e,...t){let r=we();if(r){let a=r.handlers[e];if(a)return a(r,...t)}}function m(e,t){let r=yt({or:t,and:"string"==typeof e?{name:e}:e}),a=(e,...t)=>(ue(!X(a,"derived"),"call of derived event","createEvent"),ue(!ot,"unit call from pure function","operators like sample"),st?((e,t,r,a)=>{let n=st,i=null;if(t)for(i=st;i&&i.template!==t;)i=K(i);ft(i);let o=e.create(r,a);return ft(n),o})(a,n,e,t):a.create(e,t)),n=we(),i=Object.assign(a,{graphite:s({meta:Ct(r.actualOp||"event",a,r),regional:1}),create:e=>(l({target:a,params:e,scope:at}),e),watch:e=>$t(a,e),map:e=>jt(a,L,e,[We()]),filter:e=>jt(a,"filter",e.fn?e:e.fn,[We(Re,1)]),filterMap:e=>jt(a,"filterMap",e,[We(),Le((e=>!je(e)),1)]),prepend(e){let t=m("* → "+a.shortName,{parent:K(a)});return p("eventPrepend",W(t)),Mt(t,a,[We()],"prepend",e),zt(a,t),t}});return null!=r&&r.domain&&r.domain.hooks.event(i),Y(i,"id",i.graphite.id),ke(i.graphite),i}function h(e,t,r,a){return Ne(r,t,"first argument"),i(Ce(a),"second argument should be a function"),ue(!X(e,"derived"),`${t} in derived store`,`${t} in store created via createStore`),n(Array.isArray(r)?r:[r],(t=>{e.off(t),J(e).set(t,St(At(t,e,"on",De,a)))})),e}function g(e,t){let r=yt(t),a=He(e),o=m({named:"updates",derived:1});p("storeBase",a);let f=a.id,d={subscribers:new Map,updates:o,defaultState:e,stateRef:a,getState(){let e,t=a;if(st){let t=st;for(;t&&!t.reg[f];)t=K(t);t&&(e=t)}return!e&&at&&(ht(at,a,1),e=at),e&&(t=e.reg[f]),Ue(t)},setState:e=>l({target:d,params:e,defer:1,scope:at}),reset:(...e)=>(n(e,(e=>h(d,".reset",e,(()=>d.defaultState)))),d),on:(e,t)=>h(d,".on",e,t),off(e){let t=J(d).get(e);return t&&(t(),J(d).delete(e)),d},map(e,t){let r,n;ze(e)&&(r=e,e=e.fn),ue(je(t),"second argument of store.map","updateFilter");let i=d.getState();we()?n=null:je(i)||(n=e(i,t));let o=g(n,{name:`${d.shortName} → *`,derived:1,and:r}),s=At(d,o,L,qe,e);return Ve(U(o),{type:L,fn:e,from:a}),U(o).noInit=1,p("storeMap",a,s),o},watch(e,t){if(!t||!ee(e)){let t=$t(d,e);return p("storeWatch",a,e)||e(d.getState()),t}return i(Ce(t),"second argument should be a function"),e.watch((e=>t(d.getState(),e)))}},u=Ct("store",d,r),c=d.defaultConfig.updateFilter;d.graphite=s({scope:{state:a,fn:c},node:[Le(((e,t,r)=>(r.scope&&!r.scope.reg[a.id]&&(r.b=1),e))),Te(a),Le(((e,t,{a:r,b:a})=>!je(e)&&(e!==r||a)),1),c&&We(qe,1),_e({from:T,target:a})],child:o,meta:{...u,defaultState:e},regional:1}),Y(d,"id",d.graphite.id),Y(d,"rootStateRefId",f);let y=X(d,"serialize"),b=X(d,"derived"),v="ignore"===y,k=X(d,"sid");return k&&(Y(d,"storeChange",1),a.sid=k),k||v||b||Y(d,"warnSerialize",1),i(b||!je(e),"current state can't be undefined, use null instead"),xe(d,[o]),null!=r&&r.domain&&r.domain.hooks.store(d),b||(d.reinit=m({named:"reinit"}),d.reset(d.reinit)),a.meta=d.graphite.meta,ke(d.graphite),d}function y(...e){let t,r,a;[e,a]=c(e);let n,o,s,l=e[e.length-1];if(Ce(l)?(r=e.slice(0,-1),t=l):r=e,1===r.length){let e=r[0];re(e)||(n=e,o=1)}if(!o&&(n=r,t)){s=1;let e=t;t=t=>e(...t)}return i(ze(n),"shape should be an object"),It(Array.isArray(n),!s,n,a,t)}function b(...e){return ue(0,"createStoreObject","combine"),y(...e)}function v(){let e={};return e.req=new Promise(((t,r)=>{e.rs=t,e.rj=r})),e.req.catch((()=>{})),e}function k(e,t={}){let r=yt(Ce(e)?{handler:e}:e,t),a=m(Ce(e)?{handler:e}:e,{...t,actualOp:"effect"}),n=W(a);Y(n,"op",a.kind="effect"),a.use=e=>(i(Ce(e),".use argument should be a function"),p.scope.handler=e,a),a.use.getCurrent=()=>p.scope.handler;let o=a.finally=m({named:"finally",derived:1}),f=a.done=o.filterMap({named:"done",fn({status:e,params:t,result:r}){if("done"===e)return{params:t,result:r}}}),d=a.fail=o.filterMap({named:"fail",fn({status:e,params:t,error:r}){if("fail"===e)return{params:t,error:r}}}),u=a.doneData=f.map({named:"doneData",fn:({result:e})=>e}),c=a.failData=d.map({named:"failData",fn:({error:e})=>e}),p=s({scope:{handler:a.defaultConfig.handler||(()=>i(0,`no handler used in ${a.getType()}`))},node:[Le(((e,t,r)=>{let n=t.handler,i=Q(r);if(i){let e=i.handlers.unitMap.get(a)||i.handlers.sidMap[a.sid];e&&(n=e)}return e.handler=n,e}),0,1),Le((({params:e,req:t,handler:r,args:a=[e]},n,i)=>{let s=Ot(i),l=qt(e,t,1,o,i,s),f=qt(e,t,0,o,i,s),[d,u]=Nt(r,f,a);d&&(ze(u)&&Ce(u.then)?u.then(l,f):l(u))}),0,1)],meta:{op:"fx",fx:"runner"}});n.scope.runner=p,de(n.seq,Le(((e,{runner:t},r)=>{let a=K(r)?{params:e,req:{rs(e){},rj(e){}}}:e;return r.meta||(r.meta={fxID:ye()}),l({target:t,params:a,defer:1,scope:Q(r),meta:r.meta}),a.params}),0,1)),a.create=e=>{let t=v(),r={params:e,req:t};if(at&&!it){let e=at;t.req.finally((()=>{lt(e)})).catch((()=>{}))}return l({target:a,params:r,scope:at}),t.req};let h=a.inFlight=g(0,{serialize:"ignore",named:(X(a,"name")||a.graphite.id)+".inFlight"}).on(a,(e=>e+1)).on(o,(e=>e-1)).map({fn:e=>e,named:"inFlight"});Y(o,"needFxCounter","dec"),Y(a,"needFxCounter",1);let y=a.pending=h.map({fn:e=>e>0,named:"pending"});return xe(a,[o,f,d,u,c,y,h]),null!=r&&r.domain&&r.domain.hooks.effect(a),a}function w(e){let t;[e,t]=c(e,1);let{source:r,effect:a,mapParams:n}=e,i=k(e,t);Y(i,"attached",1);let o,{runner:s}=W(i).scope,f=Le(((e,t,a)=>{let o,{params:s,req:f,handler:d}=e,u=i.finally,c=Ot(a),p=qt(s,f,0,u,a,c),m=a.a,h=ne(d),g=1;if(n?[g,o]=Nt(n,p,[s,m]):o=r&&h?m:s,g){if(!h)return e.args=[m,o],1;l({target:d,params:{params:o,req:{rs:qt(s,f,1,u,a,c),rj:p}},page:a.page,defer:1,meta:a.meta})}}),1,1);if(r){let e;re(r)?(e=r,xe(e,[i])):(e=y(r),xe(i,[e])),o=[Te(U(e)),f]}else o=[f];s.seq.splice(1,0,...o),i.use(a);let d=K(a);return d&&(Object.assign(Z(i),u(i.shortName,d)),i.defaultConfig.parent=d),zt(a,i,"effect"),i}function S(...e){let[[t,r],n]=c(e),i={};return a(r,((e,r)=>{let a=i[r]=m(r,{parent:K(t),config:n});t.on(a,e),zt(t,a)})),i}function M(e,t){let r=yt({or:t,and:"string"==typeof e?{name:e}:e}),i=s({family:{type:"domain"},regional:1,parent:(null==r?void 0:r.domain)||(null==r?void 0:r.parent)}),o={history:{},graphite:i,hooks:{}};i.meta=Ct("domain",o,{parent:(null==r?void 0:r.domain)||(null==r?void 0:r.parent),or:r}),a({Event:m,Effect:k,Store:g,Domain:M},((e,t)=>{let r=t.toLowerCase(),a=m({named:`on${t}`});o.hooks[r]=a;let i=new Set;o.history[`${r}s`]=i,a.create=e=>(l(a,e),e),de(W(a).seq,Le(((e,t,r)=>(r.scope=null,e)))),a.watch((e=>{xe(o,[e]),i.add(e),e.ownerSet||(e.ownerSet=i),K(e)||(e.parent=o)})),xe(o,[a]),o[`onCreate${t}`]=e=>(n(i,e),a.watch(e)),o[`create${t}`]=o[r]=(t,r)=>{let n=yt({and:r,or:t});return null!=n&&n.domain?e(t,r):a(e(t,{parent:o,or:n}))}}));let f=K(o);return f&&a(o.hooks,((e,t)=>Mt(e,f.hooks[t]))),null!=r&&r.domain&&r.domain.hooks.domain(o),o}function x(e){Ae(e);let t=B in e?e[B]():e;i(t.subscribe,"expect observable to have .subscribe");let r=m(),a=St(r);return t.subscribe({next:r,error:a,complete:a}),r}function $(e,t){Ne(e,"merge","first argument");let r=m({name:f(e,"merge"),derived:1,and:t});return Mt(e,r,[],"merge"),r}function z(e,t){let r=0;return n(Rt,(a=>{a in e&&(i(null!=e[a],Ft(t,a)),r=1)})),r}function C(...e){let t,r,a,n,[[i,o,s],l]=c(e),f=1;return je(o)&&ze(i)&&z(i,"sample")&&(o=i.clock,s=i.fn,f=!i.greedy,n=i.filter,t=i.target,r=i.name,a=i.sid,i=i.source),Et("sample",o,i,n,t,s,r,l,f,1,0,a)}function j(...e){let[[t,r],a]=c(e);return r||(r=t,t=r.source),z(r,"guard"),Et("guard",r.clock,t,r.filter,r.target,null,r.name,a,!r.greedy,0,1)}function A(e,t,r){if(re(e))return ue(0,"restore($store)"),e;if(ae(e)||ne(e)){let a=K(e),n=g(t,{parent:a,name:e.shortName,and:r});return Mt(ne(e)?e.doneData:e,n),a&&a.hooks.store(n),n}let n=Array.isArray(e)?[]:{};return a(e,((e,t)=>n[t]=re(e)?e:g(e,{name:t}))),n}function I(...e){let t,r,n="split",[[o,l],f]=c(e),d=!l;d&&(t=o.cases,l=o.match,r=o.clock,o=o.source);let u=re(l),h=!ee(l)&&Ce(l),g=!u&&!h&&ze(l);i(ee(o),"source must be a unit"),t||(t={}),d?a(t,((e,t)=>Oe(n,e,`cases.${t}`))):(i(g,"match should be an object"),a(l,((e,r)=>t[r]=m({derived:1,named:`cases.${r}`,and:f}))),t.__=m({derived:1,named:"cases.__",and:f}));let y,b=new Set([].concat(o,r||[],Object.values(t))),v=Object.keys(u||h?t:l);if(u||h)u&&b.add(l),y=[u&&Te(U(l),0,1),Pe({safe:u,filter:1,pure:!u,fn(e,t,r){let a=String(u?r.a:l(e));Bt(t,le(v,a)?a:"__",e,r)}})];else if(g){let e=He({});e.type="shape";let t,r=[];a(l,((a,n)=>{if(ee(a)){t=1,de(r,n),b.add(a);let i=Mt(a,[],[Te(e),Le(((e,t,{a:r})=>r[n]=e))]);if(re(a)){e.current[n]=a.getState();let t=U(a);Ve(e,{from:t,field:n,type:"field"}),p("splitMatchStore",t,i)}}})),t&&p("splitBase",e),y=[t&&Te(e,0,1),We(((e,t,a)=>{for(let n=0;n<v.length;n++){let i=v[n];if(le(r,i)?a.a[i]:l[i](e))return void Bt(t,i,e,a)}Bt(t,"__",e,a)}),1)]}else i(0,"expect match to be unit, function or object");let k=s({meta:{op:n},parent:r?[]:o,scope:t,node:y,family:{owners:Array.from(b)},regional:1});if(r&&Et(n,r,o,null,k,null,n,f,0,0,0),!d)return t}function N(e,{scope:t,params:r}={}){if(!ee(e))return Promise.reject(new Error("first argument should be unit"));if(!(ne(e)||ae(e)||re(e)||oe(e)))return Promise.reject(new Error("first argument accepts only effects, events, stores or scopes"));oe(e)&&(t=e);let a=v();a.parentFork=at;let{fxCount:n}=t;de(n.scope.defers,a);let i=[],o=[];return oe(e)||(de(i,e),de(o,ne(e)?{params:r,req:{rs(e){a.value={status:"done",value:e}},rj(e){a.value={status:"fail",value:e}}}}:r)),de(i,n),de(o,null),l({target:i,params:o,scope:t}),a.req}function O(e,t,r){let a=[];!function e(i){le(a,i)||(de(a,i),"store"===X(i,"op")&&(r||X(i,"sid"))&&t(i,X(i,"sid")),n(i.next,e),n(G(i),e),n(H(i),e))}(e)}function q(e,t){let r=Array.isArray(e)?new Map(e):e,a=new Map,o=0;if(r instanceof Map){let e={};return n(r,((r,n)=>{i(ee(n),"Map key should be a unit"),t&&t(n,r),n.sid&&(n.sid in e&&(o=1),e[n.sid]=r),a.set(n,r)})),{sidMap:e,unitMap:a,hasSidDoubles:o}}return{sidMap:r,unitMap:a}}function D(e,t){let r,a=e;ie(e)&&(r=e,a=t);let o=(e=>{let t=s({scope:{defers:[],inFlight:0,fxID:0},node:[Le(((e,t,r)=>{K(r)?"dec"===X(K(r).node,"needFxCounter")?t.inFlight-=1:(t.inFlight+=1,t.fxID+=1):t.fxID+=1})),Pe({priority:"sampler",batch:1}),Le(((e,t)=>{let{defers:r,fxID:a}=t;t.inFlight>0||0===r.length||Promise.resolve().then((()=>{t.fxID===a&&n(r.splice(0,r.length),(e=>{lt(e.parentFork),e.rs(e.value)}))}))}),0,1)]}),r=s({node:[Le(((e,t,r)=>{let a=K(r);if(a){let t=a.node;if(!X(t,"isCombine")||K(a)&&"combine"!==X(K(a).node,"op")){let a=Q(r),n=t.scope.state.id,i=X(t,"sid");a.sidIdMap[i]=n,a.values.sidMap[i]=e;let o=X(t,"serialize");o&&a.sidSerializeSettings.set(i,"ignore"===o?{ignore:1}:{ignore:0,write:o.write})}}}))]}),a=s({node:[Le(((e,t,r)=>{let a=Q(r);if(a){let e=K(r);e&&(!X(e.node,"isCombine")||K(e)&&"combine"!==X(K(e).node,"op"))&&(a.warnSerialize=1)}}))]}),i={cloneOf:e,reg:{},values:{sidMap:{},idMap:{}},sidIdMap:{},sidSerializeSettings:new Map,getState(e){if("current"in e)return ct(st,i,null,e).current;let t=W(e);return ct(st,i,t,t.scope.state,1).current},kind:"scope",graphite:s({family:{type:"domain",links:[t,r,a]},meta:{unit:"fork"},scope:{forkInFlightCounter:t}}),additionalLinks:{},handlers:{sidMap:{},unitMap:new Map},fxCount:t,storeChange:r,warnSerializeNode:a,activeEffects:[]};return i})(r);if(a){let e=a.scope;if(e){let t=e.activeEffects;e.activeEffects=[],o.activeEffects=t,n(t,(e=>e.ref=o))}if(a.values){let{sidMap:e,unitMap:t,hasSidDoubles:r}=q(a.values,(e=>i(re(e),"Values map can contain only stores as keys")));Object.assign(o.values.sidMap,e),n(t,((e,t)=>{o.values.idMap[t.stateRef.id]=e})),o.fromSerialize=!(Array.isArray(a.values)||a.values instanceof Map),o.hasSidDoubles=r}a.handlers&&(o.handlers=q(a.handlers,(e=>i(ne(e),"Handlers map can contain only effects as keys"))))}return o}function R(e,{values:t}){i(ze(t),"values property should be an object");let{sidMap:r,unitMap:a}=q(t),o=Object.getOwnPropertyNames(r),s={};n(a,((e,t)=>{s[t.stateRef.id]=t}));let f,d,u,c=[],p=[];oe(e)?(f=e,u=1,i(f.cloneOf,"scope should be created from domain"),d=W(f.cloneOf)):ie(e)?d=W(e):i(0,"first argument of hydrate should be domain or scope"),O(d,((e,t)=>{if(t&&le(o,t)){de(c,e);let a=X(e,"serialize");a&&"ignore"!==a&&(r[t]=a.read(r[t])),de(p,r[t])}else e.scope.state.id in s&&(de(c,e),de(p,a.get(s[e.scope.state.id])))}),1),l({target:c,params:p,scope:f}),u&&Object.assign(f.values.sidMap,r)}function F(e,{scope:t,safe:r}={}){i(t||at||r,"scopeBind cannot be called outside of forked .watch");let a=t||at;return ne(e)?t=>{let r=v();return l({target:e,params:{params:t,req:r},scope:a}),r.req}:t=>(l({target:e,params:t,scope:a}),t)}function E(e,t={}){e.warnSerialize&&console.error("There is a store without sid in this scope, its value is omitted"),i(!e.hasSidDoubles,"duplicate sid found in this scope");let r=t.ignore?t.ignore.map((({sid:e})=>e)):[],n={};return a(e.values.sidMap,((t,a)=>{var i;if(le(r,a))return;let o=e.sidIdMap[a],s=null!==(i=e.sidSerializeSettings.get(a))&&void 0!==i?i:{ignore:0,write:Tt};s.ignore||(n[a]=(0,s.write)(o&&o in e.reg?e.reg[o].current:t))})),"onlyChanges"in t&&!t.onlyChanges&&(i(e.cloneOf,"scope should be created from domain"),O(W(e.cloneOf),((t,a)=>{a in n||le(r,a)||X(t,"isCombine")||"ignore"===X(t,"serialize")||(n[a]=e.getState(t))}))),n}function _({unit:e,fn:t,scope:r}){let a=[Ge.run({fn:e=>t(e)})];if(r){let t=s({node:a}),n=e.graphite.id,i=r.additionalLinks,o=i[n]||[];return i[n]=o,o.push(t),P((()=>{let e=o.indexOf(t);-1!==e&&o.splice(e,1),wt(t)}))}{let t=s({node:a,parent:[e],family:{owners:e}});return P((()=>{wt(t)}))}}function P(e){let t=()=>e();return t.unsubscribe=()=>e(),t}r.r(t),r.d(t,{allSettled:()=>N,attach:()=>w,clearNode:()=>wt,combine:()=>y,createApi:()=>S,createDomain:()=>M,createEffect:()=>k,createEvent:()=>m,createNode:()=>s,createStore:()=>g,createStoreObject:()=>b,createWatch:()=>_,fork:()=>D,forward:()=>xt,fromObservable:()=>x,guard:()=>j,hydrate:()=>R,is:()=>se,launch:()=>l,merge:()=>$,restore:()=>A,sample:()=>C,scopeBind:()=>F,serialize:()=>E,setGraphInspector:()=>be,setInspector:()=>pt,setStoreName:()=>d,split:()=>I,step:()=>Ge,version:()=>Lt,withFactory:()=>Me,withRegion:()=>o});let B="undefined"!=typeof Symbol&&Symbol.observable||"@@observable",L="map",T="stack",W=e=>e.graphite||e,G=e=>e.family.owners,H=e=>e.family.links,U=e=>e.stateRef,V=e=>e.value,J=e=>e.subscribers,K=e=>e.parent,Q=e=>e.scope,X=(e,t)=>W(e).meta[t],Y=(e,t,r)=>W(e).meta[t]=r,Z=e=>e.compositeName,ee=e=>(Ce(e)||ze(e))&&"kind"in e;const te=e=>t=>ee(t)&&t.kind===e;let re=te("store"),ae=te("event"),ne=te("effect"),ie=te("domain"),oe=te("scope");var se={__proto__:null,unit:ee,store:re,event:ae,effect:ne,domain:ie,scope:oe,attached:e=>ne(e)&&1==X(e,"attached")};let le=(e,t)=>e.includes(t),fe=(e,t)=>{let r=e.indexOf(t);-1!==r&&e.splice(r,1)},de=(e,t)=>e.push(t),ue=(e,t,r)=>!e&&console.error(`${t} is deprecated${r?`, use ${r} instead`:""}`);const ce=()=>{let e=0;return()=>""+ ++e};let pe,me=ce(),he=ce(),ge=ce(),ye=ce(),be=e=>{pe=e},ve=null,ke=e=>{pe&&pe(e,ve)},we=()=>ve&&ve.template,Se=e=>(e&&ve&&ve.sidRoot&&(e=`${ve.sidRoot}|${e}`),e),Me=({sid:e,name:t,loc:r,method:a,fn:n})=>o(s({meta:{sidRoot:Se(e),sid:e,name:t,loc:r,method:a,type:"factory"}}),n),xe=(e,t)=>{let r=W(e);n(t,(e=>{let t=W(e);"domain"!==r.family.type&&(t.family.type="crosslink"),de(G(t),r),de(H(r),t)}))},$e=(e=[])=>(Array.isArray(e)?e:[e]).flat().map(W),ze=e=>"object"==typeof e&&null!==e,Ce=e=>"function"==typeof e,je=e=>void 0===e,Ae=e=>i(ze(e)||Ce(e),"expect first argument be an object");const Ie=(e,t,r,a)=>i(!(!ze(e)&&!Ce(e)||!("family"in e)&&!("graphite"in e)),`${t}: expect ${r} to be a unit (store, event or effect)${a}`);let Ne=(e,t,r)=>{Array.isArray(e)?n(e,((e,a)=>Ie(e,t,`${a} item of ${r}`,""))):Ie(e,t,r," or array of units")},Oe=(e,t,r="target")=>n($e(t),(t=>ue(!X(t,"derived"),`${e}: derived unit in "${r}"`,"createEvent/createStore"))),qe=(e,{fn:t},{a:r})=>t(e,r),De=(e,{fn:t},{a:r})=>t(r,e),Re=(e,{fn:t})=>t(e);const Fe=(e,t,r,a)=>{let n={id:he(),type:e,data:t};return r&&(n.order={priority:r},a&&(n.order.barrierID=++Ee)),n};let Ee=0,_e=({from:e="store",store:t,target:r,to:a=(r?"store":T),batch:n,priority:i})=>Fe("mov",{from:e,store:t,to:a,target:r},i,n),Pe=({fn:e,batch:t,priority:r,safe:a=0,filter:n=0,pure:i=0})=>Fe("compute",{fn:e,safe:a,filter:n,pure:i},r,t),Be=({fn:e})=>Pe({fn:e,priority:"effect"}),Le=(e,t,r)=>Pe({fn:e,safe:1,filter:t,priority:r&&"effect"}),Te=(e,t,r)=>_e({store:e,to:t?T:"a",priority:r&&"sampler",batch:1}),We=(e=Re,t)=>Pe({fn:e,pure:1,filter:t}),Ge={mov:_e,compute:Pe,filter:({fn:e,pure:t})=>Pe({fn:e,filter:1,pure:t}),run:Be},He=e=>({id:he(),current:e}),Ue=({current:e})=>e,Ve=(e,t)=>{e.before||(e.before=[]),de(e.before,t)},Je=null;const Ke=(e,t)=>{if(!e)return t;if(!t)return e;let r;return(e.v.type===t.v.type&&e.v.id>t.v.id||tt(e.v.type)>tt(t.v.type))&&(r=e,e=t,t=r),r=Ke(e.r,t),e.r=e.l,e.l=r,e},Qe=[];let Xe=0;for(;Xe<6;)de(Qe,{first:null,last:null,size:0}),Xe+=1;const Ye=()=>{for(let e=0;e<6;e++){let t=Qe[e];if(t.size>0){if(3===e||4===e){t.size-=1;let e=Je.v;return Je=Ke(Je.l,Je.r),e}1===t.size&&(t.last=null);let r=t.first;return t.first=r.r,t.size-=1,r.v}}},Ze=(e,t,r,a,n,i,o)=>et(0,{a:null,b:null,node:r,parent:a,value:n,page:t,scope:i,meta:o},e),et=(e,t,r,a=0)=>{let n=tt(r),i=Qe[n],o={v:{idx:e,stack:t,type:r,id:a},l:null,r:null};3===n||4===n?Je=Ke(Je,o):(0===i.size?i.first=o:i.last.r=o,i.last=o),i.size+=1},tt=e=>{switch(e){case"child":return 0;case"pure":return 1;case"read":return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},rt=new Set;let at,nt=1,it=0,ot=0,st=null,lt=e=>{at=e},ft=e=>{st=e};const dt=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=K(e);if(e)return e}return null};let ut,ct=(e,t,r,a,n)=>{let i=dt(e,a.id);return i?i.reg[a.id]:t?(ht(t,a,n),t.reg[a.id]):a},pt=e=>{ut=e};const mt=e=>e;let ht=(e,t,r,a,i)=>{var o;let s=e.reg;if(s[t.id])return;let l=t.sid,f=null==t||null===(o=t.meta)||void 0===o?void 0:o.serialize,d=e.fromSerialize&&"ignore"!==f&&(null==f?void 0:f.read)||mt,u={id:t.id,current:t.current,meta:t.meta};if(u.id in e.values.idMap)u.current=e.values.idMap[u.id];else if(l&&l in e.values.sidMap&&!(l in e.sidIdMap))u.current=d(e.values.sidMap[l]);else if(t.before&&!i){let i=0,o=r||!t.noInit||a;n(t.before,(t=>{switch(t.type){case L:{let n=t.from;if(n||t.fn){n&&ht(e,n,r,a);let i=n&&s[n.id].current;o&&(u.current=t.fn?t.fn(i):i)}break}case"field":i||(i=1,u.current=Array.isArray(u.current)?[...u.current]:{...u.current}),ht(e,t.from,r,a),o&&(u.current[t.field]=s[s[t.from.id].id].current)}}))}l&&(e.sidIdMap[l]=t.id),s[t.id]=u};const gt=(e,t,r)=>{try{return t(V(r),e.scope,r)}catch(t){console.error(t),e.fail=1,e.failReason=t}};let yt=(e,t={})=>(ze(e)&&(yt(e.or,t),a(e,((e,r)=>{je(e)||"or"===r||"and"===r||(t[r]=e)})),yt(e.and,t)),t);const bt=(e,t)=>{fe(e.next,t),fe(G(e),t),fe(H(e),t)},vt=(e,t,r)=>{let a;e.next.length=0,e.seq.length=0,e.scope=null;let n=H(e);for(;a=n.pop();)bt(a,e),(t||r&&"sample"!==X(e,"op")||"crosslink"===a.family.type)&&vt(a,t,"on"!==X(a,"op")&&r);for(n=G(e);a=n.pop();)bt(a,e),r&&"crosslink"===a.family.type&&vt(a,t,"on"!==X(a,"op")&&r)},kt=e=>e.clear();let wt=(e,{deep:t}={})=>{let r=0;if(e.ownerSet&&e.ownerSet.delete(e),re(e))kt(J(e));else if(ie(e)){r=1;let t=e.history;kt(t.events),kt(t.effects),kt(t.stores),kt(t.domains)}vt(W(e),!!t,r)},St=e=>{let t=()=>wt(e);return t.unsubscribe=t,t},Mt=(e,t,r,a,n)=>s({node:r,parent:e,child:t,scope:{fn:n},meta:{op:a},family:{owners:[e,t],links:t},regional:1}),xt=e=>{let t="forward",[{from:r,to:a},n]=c(e,1);return Ne(r,t,'"from"'),Ne(a,t,'"to"'),Oe(t,a,"to"),St(s({parent:r,child:a,meta:{op:t,config:n},family:{},regional:1}))},$t=(e,t)=>(i(Ce(t),".watch argument should be a function"),St(s({scope:{fn:t},node:[Be({fn:Re})],parent:e,meta:{op:"watch"},family:{owners:e},regional:1}))),zt=(e,t,r="event")=>{K(e)&&K(e).hooks[r](t)},Ct=(e,t,r)=>{let a=yt(r),n="domain"===e,i=me(),{sid:o=null,named:s=null,domain:l=null,parent:f=l}=a,d=s||a.name||(n?"":i),c=u(d,f),p={op:t.kind=e,name:t.shortName=d,sid:t.sid=Se(o),named:s,unitId:t.id=i,serialize:a.serialize,derived:a.derived,config:a};if(t.parent=f,t.compositeName=c,t.defaultConfig=a,t.thru=e=>(ue(0,"thru","js pipe"),e(t)),t.getType=()=>c.fullName,!n){t.subscribe=e=>(Ae(e),t.watch(Ce(e)?e:t=>e.next&&e.next(t))),t[B]=()=>t;let e=we();e&&(p.nativeTemplate=e)}return p};const jt=(e,t,r,a)=>{let n;ze(r)&&(n=r,r=r.fn);let i=m({name:`${e.shortName} → *`,derived:1,and:n});return Mt(e,i,a,t,r),i},At=(e,t,r,a,n)=>{let i=U(t),o=_e({store:i,to:"a",priority:"read"});r===L&&(o.data.softRead=1);let s=[o,We(a)];return p("storeOnMap",i,s,re(e)&&U(e)),Mt(e,t,s,r,n)},It=(e,t,r,n,o)=>{let s=e?e=>[...e]:e=>({...e}),l=e?[]:{},d=s(l),u=He(d),c=He(1);u.type=e?"list":"shape",u.noInit=1,p("combineBase",u,c);let m=g(d,{name:f(r),derived:1,and:n}),h=U(m);h.noInit=1,Y(m,"isCombine",1);let y=Te(u);y.order={priority:"barrier"};let b=_e({store:h,to:"b",priority:"read"});b.data.softRead=1;let v=[Le(((e,t,r)=>(r.scope&&!r.scope.reg[u.id]&&(r.c=1),e))),y,_e({store:c,to:"b"}),Le(((e,{key:r},a)=>{if(a.c||e!==a.a[r])return t&&a.b&&(a.a=s(a.a)),a.a[r]=e,1}),1),_e({from:"a",target:u}),_e({from:"value",store:0,target:c}),_e({from:"value",store:1,target:c,priority:"barrier",batch:1}),Te(u,1),o&&We(),b];return a(r,((e,t)=>{if(!re(e))return i(!ee(e)&&!je(e),`combine expects a store in a field ${t}`),void(d[t]=l[t]=e);l[t]=e.defaultState,d[t]=e.getState();let r=Mt(e,m,v,"combine",o);r.scope.key=t;let a=U(e);Ve(u,{type:"field",field:t,from:a}),p("combineField",a,r)})),m.defaultShape=r,Ve(h,{type:L,from:u,fn:o}),we()||(m.defaultState=o?h.current=o(d):l),m};let Nt=(e,t,r)=>{try{return[1,e(...r)]}catch(e){return t(e),[0,null]}},Ot=e=>{let t=Q(e),r={ref:t};return t&&de(t.activeEffects,r),r},qt=(e,t,r,a,n,i)=>o=>{i.ref&&fe(i.ref.activeEffects,i),l({target:[a,Dt],params:[r?{status:"done",params:e,result:o}:{status:"fail",params:e,error:o},{value:o,fn:r?t.rs:t.rj}],defer:1,page:n.page,scope:i.ref,meta:n.meta})};const Dt=s({node:[Be({fn:({fn:e,value:t})=>e(t)})],meta:{op:"fx",fx:"sidechain"}}),Rt=["source","clock","target"],Ft=(e,t)=>e+`: ${t} should be defined`;let Et=(e,t,r,a,n,o,s,l,f,d,u,c)=>{let h=!!n;i(!je(r)||!je(t),Ft(e,"either source or clock"));let b=0;je(r)?b=1:ee(r)||(r=y(r)),je(t)?t=r:(Ne(t,e,"clock"),Array.isArray(t)&&(t=$(t))),b&&(r=t),l||s||(s=r.shortName);let v="none";(u||a)&&(ee(a)?v="unit":(i(Ce(a),"`filter` should be function or unit"),v="fn")),n?(Ne(n,e,"target"),Oe(e,n)):"none"===v&&d&&re(r)&&re(t)?n=g(o?o(Ue(U(r)),Ue(U(t))):Ue(U(r)),{name:s,sid:c,or:l}):(n=m({name:s,derived:1,or:l}),p("sampleTarget",W(n)));let k=He(),w=[];if("unit"===v){let[r,i]=Pt(a,n,t,k,e);w=[..._t(i),..._t(r)]}let[S,M]=Pt(r,n,t,k,e),x=Mt(t,n,[p("sampleSourceLoader"),_e({from:T,target:k}),..._t(M),Te(S,1,f),...w,Te(k),"fn"===v&&We(((e,t,{a:r})=>a(e,r)),1),o&&We(qe),p("sampleSourceUpward",h)],e,o);return xe(r,[x]),Object.assign(x.meta,l,{joint:1}),n};const _t=e=>[Te(e),Le(((e,t,{a:r})=>r),1)],Pt=(e,t,r,a,n)=>{let i=re(e),o=i?U(e):He(),l=He(i);return i||s({parent:e,node:[_e({from:T,target:o}),_e({from:"value",store:1,target:l})],family:{owners:[e,t,r],links:t},meta:{op:n},regional:1}),p("sampleSource",l,o,a),[o,l]},Bt=(e,t,r,a)=>{let n=e[t];n&&l({target:n,params:Array.isArray(n)?n.map((()=>r)):r,defer:1,stack:a})},Lt="22.8.8",Tt=e=>e}}]);